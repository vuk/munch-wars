"use strict";function getParameterByName(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function handleIncorrect(){game.device.desktop||(document.getElementById("turn").style.display="flex")}function handleCorrect(){game.device.desktop||(document.getElementById("turn").style.display="none")}var sync=0,initializeSound=function(){"true"===localStorage.getItem("muted")&&(game.sound.mute=!0)},toggleSound=function(){var e;e="true"===localStorage.getItem("muted"),game&&(game.sound.mute=!e),localStorage.setItem("muted",(!e).toString()),e?($(".sound-on-wrapper").addClass("active"),$(".sound-off-wrapper").removeClass("active")):($(".sound-off-wrapper").addClass("active"),$(".sound-on-wrapper").removeClass("active"))},gameProperties={screenWidth:800,screenHeight:400,dashSize:5,paddleLeft_x:30,paddleRight_x:770,paddleVelocity:600,paddleSegmentsMax:8,paddleSegmentHeight:2,paddleSegmentAngle:8,paddleTopGap:0,ballVelocity:600,ballRandomStartingAngleLeft:[-120,120],ballRandomStartingAngleRight:[-60,60],ballStartDelay:2,ballVelocityIncrement:40,ballReturnCount:4,scoreToWin:6},graphicAssets={ballURL:"assets/ball-15.png",ballName:"ball",paddleURL:"assets/left-45.png",paddleDoubleURL:"assets/left-90.png",paddleName:"paddle_left",paddleDoubleName:"double_paddle_left",paddleRightURL:"assets/right-45.png",paddleRightDoubleUrl:"assets/right-90.png",paddleRightName:"paddle_right",paddleDoubleRightName:"double_paddle_right",yellowBorder:"assets/yellow-border.png",yellowBorderName:"yellowBorder",redBorder:"assets/red-border.png",redBorderName:"redBorder",bulletLeftUrl:"/assets/bullet-left-50.png",bulletLeftName:"bulletLeft",bulletRightUrl:"/assets/bullet-right-50.png",bulletRightName:"bulletRight"},soundAssets={ballBounceURL:"assets/audio/menu",ballBounceName:"ballBounce",ballHitURL:"assets/audio/menu",ballHitName:"ballHit",ballMissedURL:"assets/ballMissed",ballMissedName:"ballMissed",shotUrl:"assets/audio/shot",shotName:"shot",getMagicUrl:"assets/audio/getmagic",getMagicName:"getMagic",useMagicUrl:"assets/audio/usemagic",useMagicName:"useMagic",mp4URL:".m4a",oggURL:".ogg"},fontAssets={scoreLeft_x:.25*gameProperties.screenWidth,scoreRight_x:.75*gameProperties.screenWidth,scoreTop_y:10,scoreFontStyle:{font:"80px orbitron",fill:"#FFFFFF",align:"center"},instructionsFontStyle:{font:"16px orbitron",fill:"#FFDF00",align:"center",fontWeight:500},countdownFontStyle:{font:"72px orbitron",fill:"#FFDF00",align:"center",fontWeight:600},getReadyStyle:{font:"28px orbitron",fill:"#FFDF00",align:"center",fontWeight:600}},labels={clickToStart:"STRELICAMA GORE/DOLE POMERAŠ MUNCH, \nBROJEVIMA 1/2/3 ISPALJUJEŠ MAGIJE \n\n OSTVARI 6 BODOVA ZA POBEDU",getReady:"PRIPREMI SE!"},isHome=!1,mainState=function(e){this.backgroundGraphics,this.ballSprite,this.paddleLeftSprite,this.paddleRightSprite,this.paddleGroup,this.paddleLeft_up,this.paddleLeft_down,this.paddleRight_up,this.paddleRight_down,this.missedSide,this.scoreLeft,this.scoreRight,this.timer,this.timerEvent,this.sndBallHit,this.sndBallBounce,this.sndBallMissed,this.instructions,this.ballVelocity,this.lastHitBy=-1,this.players=[{id:"left",color:"black",magic:[]},{id:"right",color:"white",magic:[]}]};if(mainState.prototype={preload:function(){this.strikeCount=0,this.leftStrikeCount=0,this.rightStrikeCount=0,this.bulletLeftSprite=null,this.bulletRightSprite=null,game.scale.forceOrientation(!0,!1),game.scale.enterIncorrectOrientation.add(handleIncorrect),game.scale.leaveIncorrectOrientation.add(handleCorrect),game.load.image(graphicAssets.ballName,graphicAssets.ballURL),game.load.image(graphicAssets.paddleName,graphicAssets.paddleURL),game.load.image(graphicAssets.paddleDoubleName,graphicAssets.paddleDoubleURL),game.load.image(graphicAssets.paddleRightName,graphicAssets.paddleRightURL),game.load.image(graphicAssets.paddleDoubleRightName,graphicAssets.paddleRightDoubleUrl),game.load.image(graphicAssets.yellowBorderName,graphicAssets.yellowBorder),game.load.image(graphicAssets.redBorderName,graphicAssets.redBorder),game.load.image(graphicAssets.bulletLeftName,graphicAssets.bulletLeftUrl),game.load.image(graphicAssets.bulletRightName,graphicAssets.bulletRightUrl),initializeSound(),this.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,this.scale.pageAlignHorizontally=!0,this.scale.pageAlignVertically=!0,game.load.audio(soundAssets.ballBounceName,[soundAssets.ballBounceURL+soundAssets.mp4URL,soundAssets.ballBounceURL+soundAssets.oggURL]),game.load.audio(soundAssets.ballHitName,[soundAssets.ballHitURL+soundAssets.mp4URL,soundAssets.ballHitURL+soundAssets.oggURL]),game.load.audio(soundAssets.ballMissedName,[soundAssets.ballMissedURL+soundAssets.mp4URL,soundAssets.ballMissedURL+soundAssets.oggURL]),game.load.audio(soundAssets.ballMissedName,[soundAssets.ballMissedURL+soundAssets.mp4URL,soundAssets.ballMissedURL+soundAssets.oggURL]),game.load.audio(soundAssets.shotName,[soundAssets.shotUrl+soundAssets.mp4URL,soundAssets.shotUrl+soundAssets.oggURL]),game.load.audio(soundAssets.useMagicName,[soundAssets.useMagicUrl+soundAssets.mp4URL,soundAssets.useMagicUrl+soundAssets.oggURL]),game.load.audio(soundAssets.getMagicName,[soundAssets.getMagicUrl+soundAssets.mp4URL,soundAssets.getMagicUrl+soundAssets.oggURL])},create:function(){this.y=game.world.centerY,this.initGraphics(),this.initPhysics(),this.initKeyboard(),this.initSounds(),this.startDemo(),this.drawBorders(),this.enablePaddles(!0);var e=this;this.cnt=1,this.submitted=!1,$("#accept_invite").click(function(){game.state.start("main",!0,!1)}),$("#left-player-magic-1, #right-player-magic-1").click(function(){e.fireMagic(1)}),$("#left-player-magic-2, #right-player-magic-2").click(function(){e.fireMagic(2)}),$("#left-player-magic-3, #right-player-magic-3").click(function(){e.fireMagic(3)}),computer?(this.side=localStorage.getItem("side"),this.side||(this.side="black"),this.startCountdown()):(userId===getParameterByName("game")&&(isHome=!0),socket.on("start_game",function(t){$("#invited_modal").modal("hide"),e.side=isHome?"white"===t.guestSide?"black":"white":t.guestSide,"white"===t.guestSide?($("#right-name").html(t.player1.profile.DisplayName),$("#right-name-go").html(t.player1.profile.DisplayName),$("#right-rank").html('<img src="'+getRankIcon(_.find(t.player1.stats.data.Statistics,{StatisticName:"Total Points"})?_.find(t.player1.stats.data.Statistics,{StatisticName:"Total Points"}).Value:0)+'"/>'),$("#right-rank-go").html('<img src="'+getRankIcon(_.find(t.player1.stats.data.Statistics,{StatisticName:"Total Points"})?_.find(t.player1.stats.data.Statistics,{StatisticName:"Total Points"}).Value:0)+'"/>'),$("#left-name").html(t.player2.profile.DisplayName),$("#left-name-go").html(t.player2.profile.DisplayName),$("#left-rank").html('<img src="'+getRankIcon(_.find(t.player2.stats.data.Statistics,{StatisticName:"Total Points"})?_.find(t.player2.stats.data.Statistics,{StatisticName:"Total Points"}).Value:0)+'"/>'),$("#left-rank-go").html('<img src="'+getRankIcon(_.find(t.player2.stats.data.Statistics,{StatisticName:"Total Points"})?_.find(t.player2.stats.data.Statistics,{StatisticName:"Total Points"}).Value:0)+'"/>')):($("#right-name").html(t.player2.profile.DisplayName),$("#right-name-go").html(t.player2.profile.DisplayName),$("#right-rank").html('<img src="'+getRankIcon(_.find(t.player2.stats.data.Statistics,{StatisticName:"Total Points"})?_.find(t.player2.stats.data.Statistics,{StatisticName:"Total Points"}).Value:0)+'"/>'),$("#right-rank-go").html('<img src="'+getRankIcon(_.find(t.player2.stats.data.Statistics,{StatisticName:"Total Points"})?_.find(t.player2.stats.data.Statistics,{StatisticName:"Total Points"}).Value:0)+'"/>'),$("#left-name").html(t.player1.profile.DisplayName),$("#left-name-go").html(t.player1.profile.DisplayName),$("#left-rank").html('<img src="'+getRankIcon(_.find(t.player1.stats.data.Statistics,{StatisticName:"Total Points"})?_.find(t.player1.stats.data.Statistics,{StatisticName:"Total Points"}).Value:0)+'"/>'),$("#left-rank-go").html('<img src="'+getRankIcon(_.find(t.player1.stats.data.Statistics,{StatisticName:"Total Points"})?_.find(t.player1.stats.data.Statistics,{StatisticName:"Total Points"}).Value:0)+'"/>')),e.startCountdown()})),socket.on("update_state",function(t){this.lastUpdate=Date.now(),(!e.syncData.time||e.syncData.time<=t.time&&t.ball.visible)&&(e.syncData=t)}),socket.on("score",function(t){e.scoreLeft=t.scoreLeft,e.scoreRight=t.scoreRight,e.leftStrikeCount=t.leftStrikeCount,e.rightStrikeCount=t.rightStrikeCount,e.updateScoreTextFields()}),socket.on("magic",function(t){e.players=t.players,e.updatePlayerMagicUI(e.players[0]),e.updatePlayerMagicUI(e.players[1])}),socket.on("sync_shot",function(t){t.myId!==userId&&e.handleShot(t.side,t.y)}),socket.on("sync_hor",function(t){t.myId!==userId&&e.handleHor(!1)}),socket.on("sync_ver",function(t){t.myId!==userId&&e.handleVer(!1)}),socket.on("sync_double",function(t){t.myId!==userId&&e.handleDouble(t.side)}),isHome||(socket.on("gameover",function(t){e.ballSprite.reset(game.world.centerX,game.world.centerY),e.ballSprite.kill(),$("#game-over").show(),game.sound.stopAll(),e.enablePaddles(!1),e.enableBoundaries(!0),$(".hide-on-go span").hide(),e.resetBall()}),socket.on("outOfBounds",function(){e.ballOutOfBounds()}))},shotRight:function(){var e=game.time.create(!1),t=this;this.blockRightPaddle=!0,e.loop(3e3,function(){t.blockRightPaddle=!1},this),e.start(),this.bulletLeftSprite.kill()},shotLeft:function(){var e=game.time.create(!1),t=this;this.blockLeftPaddle=!0,e.loop(3e3,function(){t.blockLeftPaddle=!1},this),e.start(),this.bulletRightSprite.kill()},leftOutBounds:function(){this.bulletLeftSprite.destroy()},rightOutBounds:function(){this.bulletRightSprite.destroy()},lastBallUpdate:0,syncData:{},lastUpdate:0,updateState:function(){this.lastUpdate=Date.now(),this.syncData&&("white"===this.side&&this.syncData.paddle&&this.syncData.paddle.left&&this.syncData.paddle.left.y&&(this.paddleLeftSprite.body.velocity.y=this.syncData.paddle.left.velocity,this.paddleLeftSprite.y=this.syncData.paddle.left.y),"black"===this.side&&this.syncData.paddle&&this.syncData.paddle.right&&this.syncData.paddle.right.y&&(this.paddleRightSprite.body.velocity.y=this.syncData.paddle.right.velocity,this.paddleRightSprite.y=this.syncData.paddle.right.y),this.syncData&&this.syncData.ball&&!isHome&&this.syncData.ball.x&&(this.ballSprite.visible=this.syncData.ball.visible,game.add.tween(this.ballSprite).to({x:this.syncData.ball.x+this.ballSprite.width/2,y:this.syncData.ball.y+this.ballSprite.height/2},22,Phaser.Easing.Linear.None,!0,0)))},update:function(){this.updateState(),this.moveLeftPaddle(),this.moveRightPaddle(),this.fireMagic(),this.y=game.input.y,game.physics.arcade.overlap(this.ballSprite,this.paddleGroup,this.collideWithPaddle,null,this),game.physics.arcade.overlap(this.ballSprite,this.centerBottomBorder,this.collideWithMagicBounds,null,this),game.physics.arcade.overlap(this.ballSprite,this.centerTopBorder,this.collideWithMagicBounds,null,this),this.bulletRightSprite&&(this.bulletRightSprite.events.onOutOfBounds.add(this.rightOutBounds,this),game.physics.arcade.overlap(this.bulletRightSprite,this.paddleLeftSprite,this.shotLeft,null,this)),this.bulletLeftSprite&&(this.bulletLeftSprite.events.onOutOfBounds.add(this.leftOutBounds,this),game.physics.arcade.overlap(this.bulletLeftSprite,this.paddleRightSprite,this.shotRight,null,this)),(this.ballSprite.body.blocked.up||this.ballSprite.body.blocked.down||this.ballSprite.body.blocked.left||this.ballSprite.body.blocked.right)&&this.sndBallBounce.play();if(isHome&&!computer&&socket.emit("ball_position",{id:getParameterByName("game"),x:this.ballSprite.body.x,y:this.ballSprite.body.y,velocityX:this.ballSprite.body.velocity.x,velocityY:this.ballSprite.body.velocity.y,visible:this.ballSprite.visible,time:Date.now()}),computer){var e=this.ballSprite.body.y;if("black"===this.side)var t=-(this.paddleRightSprite.body.y+this.paddleRightSprite.body.height/2-e);else if("white"===this.side)t=-(this.paddleLeftSprite.body.y+this.paddleLeftSprite.body.height/2-e);t>10?"black"===this.side?this.moveRightPaddle("down"):"white"===this.side&&this.moveLeftPaddle("down"):t<-10&&("black"===this.side?this.moveRightPaddle("up"):"white"===this.side&&this.moveLeftPaddle("up"))}},drawBorders:function(){this.borderGroup=game.add.group(),this.borderGroup.enableBody=!0,this.borderGroup.physicsBodyType=Phaser.Physics.ARCADE,this.leftTopBorder=game.add.sprite(0,0,graphicAssets.yellowBorderName),this.leftTopBorder.anchor.set(0,0),this.rightTopBorder=game.add.sprite(game.world.width,0,graphicAssets.yellowBorderName),this.rightTopBorder.anchor.set(0,0),this.leftBottomBorder=game.add.sprite(0,400,graphicAssets.yellowBorderName),this.leftBottomBorder.anchor.set(0,1),this.rightBottomBorder=game.add.sprite(game.world.width,400,graphicAssets.yellowBorderName),this.rightBottomBorder.anchor.set(0,1),this.centerBottomBorder=game.add.sprite(game.world.centerX,400,graphicAssets.redBorderName),this.centerBottomBorder.anchor.set(.5,1),this.centerTopBorder=game.add.sprite(game.world.centerX,0,graphicAssets.redBorderName),this.centerTopBorder.anchor.set(.5,0),this.borderGroup.add(this.leftTopBorder),this.borderGroup.add(this.leftBottomBorder),this.borderGroup.add(this.rightTopBorder),this.borderGroup.add(this.rightBottomBorder),this.borderGroup.add(this.centerBottomBorder),this.borderGroup.add(this.centerTopBorder),this.borderGroup.setAll("checkWorldBounds",!0),this.borderGroup.setAll("body.collideWorldBounds",!0),this.borderGroup.setAll("body.immovable",!0)},initGraphics:function(){this.backgroundGraphics=game.add.graphics(0,0),this.backgroundGraphics.lineStyle(2,16777215,1),this.ballSprite=game.add.sprite(game.world.centerX,game.world.centerY,graphicAssets.ballName),this.ballSprite.anchor.set(.5,.5),this.paddleLeftSprite=game.add.sprite(gameProperties.paddleLeft_x,game.world.centerY,graphicAssets.paddleName),this.paddleLeftSprite.anchor.set(.5,.5),this.paddleRightSprite=game.add.sprite(gameProperties.paddleRight_x,game.world.centerY,graphicAssets.paddleRightName),this.paddleRightSprite.anchor.set(.5,.5),this.instructions=game.add.text(game.world.centerX,game.world.height-20,labels.clickToStart,fontAssets.instructionsFontStyle),this.instructions.addColor("#FFFFFF",11),this.instructions.addColor("#FFDF00",15),this.instructions.addColor("#FFFFFF",16),this.instructions.addColor("#FFDF00",20),this.instructions.addColor("#FFFFFF",46),this.instructions.addColor("#FFDF00",47),this.instructions.addColor("#FFFFFF",48),this.instructions.addColor("#FFDF00",49),this.instructions.addColor("#FFFFFF",50),this.instructions.addColor("#FFDF00",51),this.instructions.anchor.set(.5,1),this.hideTextFields()},startCountdown:function(){$("#game-over").hide(),this.timer=game.time.create(),this.countdownText=game.add.text(game.world.centerX,game.world.centerY,"3",fontAssets.countdownFontStyle),this.getReady=game.add.text(game.world.centerX,60,labels.getReady,fontAssets.getReadyStyle),this.getReady.anchor.set(.5,.5),this.countdownText.anchor.set(.5,.5),this.timerEvent=this.timer.add(3*Phaser.Timer.SECOND,this.endTimer,this),this.timer.start()},endTimer:function(){this.timer.stop(),this.countdownText.destroy(),this.getReady.visible=!1,this.startGame()},render:function(){this.timer&&this.timer.running&&this.countdownText.setText(this.formatTime(Math.round((this.timerEvent.delay-this.timer.ms)/1e3)),2,14,"#ff0")},formatTime:function(e){return(e-60*("0"+Math.floor(e/60))).toString().substr(-2)},initPhysics:function(){game.physics.startSystem(Phaser.Physics.ARCADE),game.physics.enable(this.ballSprite,Phaser.Physics.ARCADE),this.ballSprite.checkWorldBounds=!0,this.ballSprite.body.collideWorldBounds=!0,this.ballSprite.body.immovable=!0,this.ballSprite.body.bounce.set(1),this.ballSprite.events.onOutOfBounds.add(this.ballOutOfBounds,this),this.paddleGroup=game.add.group(),this.paddleGroup.enableBody=!0,this.paddleGroup.physicsBodyType=Phaser.Physics.ARCADE,this.paddleGroup.add(this.paddleLeftSprite),this.paddleGroup.add(this.paddleRightSprite),this.paddleGroup.setAll("checkWorldBounds",!0),this.paddleGroup.setAll("body.collideWorldBounds",!0),this.paddleGroup.setAll("body.immovable",!0)},initKeyboard:function(){this.paddleLeft_up=game.input.keyboard.addKey(Phaser.Keyboard.A),this.paddleLeft_down=game.input.keyboard.addKey(Phaser.Keyboard.Z),this.buttonOne=game.input.keyboard.addKey(Phaser.Keyboard.ONE),this.buttonTwo=game.input.keyboard.addKey(Phaser.Keyboard.TWO),this.buttonThree=game.input.keyboard.addKey(Phaser.Keyboard.THREE),this.paddleRight_up=game.input.keyboard.addKey(Phaser.Keyboard.UP),this.paddleRight_down=game.input.keyboard.addKey(Phaser.Keyboard.DOWN)},initSounds:function(){this.sndBallHit=game.add.audio(soundAssets.ballHitName),this.sndBallBounce=game.add.audio(soundAssets.ballBounceName),this.sndBallMissed=game.add.audio(soundAssets.ballMissedName),this.shotSound=game.add.audio(soundAssets.shotName),this.getMagic=game.add.audio(soundAssets.getMagicName),this.useMagic=game.add.audio(soundAssets.useMagicName)},startDemo:function(){this.ballSprite.reset(game.world.centerX,game.rnd.between(0,gameProperties.screenHeight)),this.ballSprite.visible=!1,this.ballSprite.body.velocity.x=0,this.ballSprite.body.velocity.y=0,this.enablePaddles(!1),this.enableBoundaries(!0),this.instructions.visible=!0},gameOver:function(){$("#game-over").show(),game.sound.stopAll(),this.ballSprite.reset(game.world.centerX,game.rnd.between(0,gameProperties.screenHeight)),this.ballSprite.visible=!1,this.ballSprite.body.velocity.x=0,this.ballSprite.body.velocity.y=0,this.enablePaddles(!1),this.enableBoundaries(!0),$(".hide-on-go span").hide(),isHome&&socket.emit("game_over",{id:getParameterByName("game"),scoreLeft:this.scoreLeft,leftStrikeCount:this.leftStrikeCount,scoreRight:this.scoreRight,rightStrikeCount:this.rightStrikeCount})},startGame:function(){game.input.onDown.remove(this.startCountdown,this),"true"===localStorage.getItem("muted")?game.sound.mute=!0:game.sound.mute=!1,this.enablePaddles(!0),this.enableBoundaries(!1),this.resetBall(),this.resetScores(),this.hideTextFields()},startBall:function(){if(this.ballVelocity=gameProperties.ballVelocity,this.ballReturnCount=0,this.ballSprite.visible=!0,isHome||computer){var e=game.rnd.pick(gameProperties.ballRandomStartingAngleRight.concat(gameProperties.ballRandomStartingAngleLeft));"right"==this.missedSide?e=game.rnd.pick(gameProperties.ballRandomStartingAngleRight):"left"==this.missedSide&&(e=game.rnd.pick(gameProperties.ballRandomStartingAngleLeft)),game.physics.arcade.velocityFromAngle(e,gameProperties.ballVelocity,this.ballSprite.body.velocity)}},resetBall:function(){isHome||computer?(this.ballSprite.reset(game.world.centerX,game.rnd.between(0,gameProperties.screenHeight)),this.ballSprite.visible=!1,this.ballSprite.body.velocity.x=0,this.ballSprite.body.velocity.y=0,game.time.events.add(Phaser.Timer.SECOND*gameProperties.ballStartDelay,this.startBall,this)):(this.ballSprite.visible=!1,this.ballSprite.body.velocity.x=0,this.ballSprite.body.velocity.y=0)},enablePaddles:function(e){this.paddleGroup.setAll("visible",e),this.paddleGroup.setAll("body.enable",e),this.paddleLeft_up.enabled=e,this.paddleLeft_down.enabled=e,this.paddleRight_up.enabled=e,this.paddleRight_down.enabled=e,this.paddleLeftSprite.y=game.world.centerY,this.paddleRightSprite.y=game.world.centerY},enableBoundaries:function(e){game.physics.arcade.checkCollision.left=e,game.physics.arcade.checkCollision.right=e},moveLeftPaddle:function(e){e=e||null;this.blockLeftPaddle||("black"===this.side&&(this.paddleRight_up.isDown||this.y>game.input.y?this.paddleLeftSprite.body.velocity.y=-gameProperties.paddleVelocity:this.paddleRight_down.isDown||this.y<game.input.y?this.paddleLeftSprite.body.velocity.y=gameProperties.paddleVelocity:this.paddleLeftSprite.body.velocity.y=0,this.paddleLeftSprite.body.y<gameProperties.paddleTopGap&&(this.paddleLeftSprite.body.y=gameProperties.paddleTopGap),this.paddleLeftSprite.body.y+this.paddleLeftSprite.height>gameProperties.screenHeight&&(this.paddleLeftSprite.body.y=gameProperties.screenHeight-this.paddleLeftSprite.height),computer||socket.emit("move_paddle",{id:getParameterByName("game"),side:"left",velocity:this.paddleLeftSprite.body.velocity.y,y:this.paddleLeftSprite.body.y+this.paddleLeftSprite.body.height/2,time:Date.now()})),computer&&"white"===this.side&&(this.paddleLeftSprite.body.velocity.y="up"===e?.6*-gameProperties.paddleVelocity:"down"===e?.6*gameProperties.paddleVelocity:0,this.paddleLeftSprite.body.y<gameProperties.paddleTopGap&&(this.paddleLeftSprite.body.y=gameProperties.paddleTopGap)))},moveRightPaddle:function(e){e=e||null;this.blockRightPaddle||("white"===this.side&&(this.paddleRight_up.isDown||this.y>game.input.y?this.paddleRightSprite.body.velocity.y=-gameProperties.paddleVelocity:this.paddleRight_down.isDown||this.y<game.input.y?this.paddleRightSprite.body.velocity.y=gameProperties.paddleVelocity:this.paddleRightSprite.body.velocity.y=0,this.paddleRightSprite.body.y<gameProperties.paddleTopGap&&(this.paddleRightSprite.body.y=gameProperties.paddleTopGap),this.paddleRightSprite.body.y+this.paddleRightSprite.height>gameProperties.screenHeight&&(this.paddleRightSprite.body.y=gameProperties.screenHeight-this.paddleRightSprite.height),computer||socket.emit("move_paddle",{id:getParameterByName("game"),side:"right",velocity:this.paddleRightSprite.body.velocity.y,y:this.paddleRightSprite.body.y+this.paddleRightSprite.body.height/2,time:Date.now()})),computer&&"black"===this.side&&(this.paddleRightSprite.body.velocity.y="up"===e?.65*-gameProperties.paddleVelocity:"down"===e?.65*gameProperties.paddleVelocity:0,this.paddleRightSprite.body.y<gameProperties.paddleTopGap&&(this.paddleRightSprite.body.y=gameProperties.paddleTopGap)))},tempLeftStrikeCount:0,tempRightStrikeCount:0,collideWithPaddle:function(e,t){this.sndBallHit.play(),this.strikeCount++,this.lastHitBy=e.x<.5*gameProperties.screenWidth?0:1,0===this.lastHitBy?this.tempLeftStrikeCount<10&&this.tempLeftStrikeCount++:this.tempRightStrikeCount<10&&this.tempRightStrikeCount++;var i,s=Math.floor((e.y-t.y)/gameProperties.paddleSegmentHeight);s>=gameProperties.paddleSegmentsMax?s=gameProperties.paddleSegmentsMax-1:s<=-gameProperties.paddleSegmentsMax&&(s=-(gameProperties.paddleSegmentsMax-1)),t.x<.5*gameProperties.screenWidth?(i=s*gameProperties.paddleSegmentAngle,game.physics.arcade.velocityFromAngle(i,this.ballVelocity,this.ballSprite.body.velocity)):((i=180-s*gameProperties.paddleSegmentAngle)>180&&(i-=360),game.physics.arcade.velocityFromAngle(i,this.ballVelocity,this.ballSprite.body.velocity)),this.ballReturnCount++,this.ballReturnCount>=gameProperties.ballReturnCount&&(this.ballReturnCount=0,this.ballVelocity+=gameProperties.ballVelocityIncrement)},collideWithMagicBounds:function(e,t){if(this.lastHitBy<0||this.magicCountdown>0)this.magicCountdown--;else{var i=this.players[this.lastHitBy];this.generateMagic(i,e,t),computer&&2===Math.floor(4*Math.random())&&this.fireMagicByComputerPlayer()}},generateMagic:function(e,t,i){var s=3===e.magic.length;if(!s&&(isHome||computer)){switch(Math.floor(4*Math.random())){case 0:e.magic.push("shoot");break;case 1:e.magic.push("double-size");break;case 2:e.magic.push("hor-position");break;case 3:e.magic.push("ver-position")}this.getMagic.play(),this.magicCountdown=1,this.updatePlayerMagicUI(e)}s||!isHome||computer||socket.emit("magic_sync",{id:getParameterByName("game"),players:this.players,evt:"earned"})},fireMagicByComputerPlayer:function(){var e="white"===this.side?0:1;if(0!==this.players[e].magic.length){var t=Math.floor(Math.random()*this.players[e].magic.length);this.processMagic(this.players[e].magic[t],e),this.players[e].magic.splice(t,1)}},updatePlayerMagicUI:function(e){var t="sprite-double-size sprite-shoot sprite-hor-position sprite-ver-position sprite-empty";jQuery("#"+e.id+"-player-magic-1").removeClass(t).addClass(void 0!==e.magic[0]?"sprite-"+e.magic[0]:"sprite-empty"),jQuery("#"+e.id+"-player-magic-2").removeClass(t).addClass(void 0!==e.magic[1]?"sprite-"+e.magic[1]:"sprite-empty"),jQuery("#"+e.id+"-player-magic-3").removeClass(t).addClass(void 0!==e.magic[2]?"sprite-"+e.magic[2]:"sprite-empty")},fireCount:10,fireMagic:function(e){if(this.fireCount>10||e){this.fireCount=0;var t="white"===this.side?1:0;(this.buttonOne.isDown&&this.players[t].magic[0]||1===e)&&(this.processMagic(this.players[t].magic[0],t),this.players[t].magic.splice(0,1),socket.emit("magic_sync",{id:getParameterByName("game"),players:this.players,evt:"fired"})),(this.buttonTwo.isDown&&this.players[t].magic[1]||2===e)&&(this.processMagic(this.players[t].magic[1],t),this.players[t].magic.splice(1,1),socket.emit("magic_sync",{id:getParameterByName("game"),players:this.players,evt:"fired"})),(this.buttonThree.isDown&&this.players[t].magic[2]||3===e)&&(this.processMagic(this.players[t].magic[2],t),this.players[t].magic.splice(2,1),socket.emit("magic_sync",{id:getParameterByName("game"),players:this.players,evt:"fired"})),this.updatePlayerMagicUI(this.players[t])}else this.fireCount++},processMagic:function(e,t){switch(e){case"shoot":this.processShot(t);break;case"double-size":this.processDouble(t);break;case"hor-position":this.processHor(t);break;case"ver-position":this.processVer(t)}},handleShot:function(e,t){this.shotSound.play(),0===e&&(this.bulletLeftSprite=game.add.sprite(gameProperties.paddleLeft_x,t||this.paddleLeftSprite.y,graphicAssets.bulletLeftName),game.physics.enable(this.bulletLeftSprite,Phaser.Physics.ARCADE),this.bulletLeftSprite.enableBody=!0,this.bulletLeftSprite.body.velocity.x=800,this.bulletLeftSprite.body.velocity.y=0),1===e&&(this.bulletRightSprite=game.add.sprite(gameProperties.paddleRight_x,t||this.paddleRightSprite.y,graphicAssets.bulletRightName),game.physics.enable(this.bulletRightSprite,Phaser.Physics.ARCADE),this.bulletRightSprite.enableBody=!0,this.bulletRightSprite.body.velocity.x=-800,this.bulletRightSprite.body.velocity.y=0)},processShot:function(e){this.handleShot(e),socket.emit("shot_sync",{id:getParameterByName("game"),y:this.paddleLeftSprite.y+this.paddleLeftSprite.height/2,side:e,myId:userId})},doubleActive:[],originalPaddleHeight:0,handleDouble:function(e){this.useMagic.play(),0!==e||this.doubleActive[e]||(this.paddleLeftSprite.key=graphicAssets.paddleDoubleName,this.paddleLeftSprite.loadTexture(graphicAssets.paddleDoubleName,0),this.originalPaddleHeight=this.paddleLeftSprite.height,this.paddleLeftSprite.height=120),1!==e||this.doubleActive[e]||(this.paddleRightSprite.key=graphicAssets.paddleDoubleRightName,this.paddleRightSprite.loadTexture(graphicAssets.paddleDoubleRightName,0),this.originalPaddleHeight=this.paddleRightSprite.height,this.paddleRightSprite.height=120),this.doubleActive[e]=!0},processDouble:function(e){this.handleDouble(e),socket.emit("double_sync",{id:getParameterByName("game"),side:e,myId:userId})},handleHor:function(e){this.useMagic.play(),this.ballSprite.body.velocity.set(-1*this.ballSprite.body.velocity.x,-1*this.ballSprite.body.velocity.y)},processHor:function(e){this.handleHor(e),socket.emit("hor_sync",{id:getParameterByName("game"),myId:userId})},handleVer:function(e){this.useMagic.play(),this.ballSprite.body.velocity.set(1.25*this.ballSprite.body.velocity.x,-1*this.ballSprite.body.velocity.y)},processVer:function(e){this.handleVer(),socket.emit("ver_sync",{id:getParameterByName("game"),myId:userId})},undoMagics:function(){this.undoDouble()},undoDouble:function(){this.doubleActive[0]&&(this.paddleLeftSprite.key=graphicAssets.paddleName,this.paddleLeftSprite.loadTexture(graphicAssets.paddleName,0),this.paddleLeftSprite.height=94,this.doubleActive[0]=!1),this.doubleActive[1]&&(this.paddleRightSprite.key=graphicAssets.paddleRightName,this.paddleRightSprite.loadTexture(graphicAssets.paddleRightName,0),this.paddleRightSprite.height=94,this.doubleActive[1]=!1)},submitted:!1,ballOutOfBounds:function(){if(this.lastHitBy=-1,this.sndBallMissed.play(),this.undoMagics(),isHome&&socket.emit("outofbounds",{id:getParameterByName("game")}),socket.emit("singleOut",{userId:userId,sync:window.sync}),(isHome||computer)&&(this.ballSprite.x<0?(this.missedSide="left",this.scoreRight++,this.rightStrikeCount+=this.tempRightStrikeCount,this.tempLeftStrikeCount=0,this.tempRightStrikeCount=0):this.ballSprite.x>gameProperties.screenWidth&&(this.missedSide="right",this.scoreLeft++,this.leftStrikeCount+=this.tempLeftStrikeCount,this.tempLeftStrikeCount=0,this.tempRightStrikeCount=0),this.updateScoreTextFields(),computer||socket.emit("relevant_score",{id:getParameterByName("game"),scoreLeft:this.scoreLeft,leftStrikeCount:this.leftStrikeCount,scoreRight:this.scoreRight,rightStrikeCount:this.rightStrikeCount})),this.scoreLeft>=gameProperties.scoreToWin){if(isHome){if(!this.submitted){this.submitted=!0;var e={id:"black"===this.side?userId:opponent||localStorage.getItem("opponentId"),points:this.leftStrikeCount+3*this.scoreLeft,pointsLoser:this.scoreRight,loserId:"black"===this.side?opponent||localStorage.getItem("opponentId"):userId,side:"black",timeFinished:(new Date).toLocaleString(),verify:verify};socket.emit("winner",e)}}else if(computer&&"black"===this.side&&!this.submitted){this.submitted=!0;var t={id:userId,points:this.leftStrikeCount+3*this.scoreLeft,pointsLoser:this.scoreRight,loserId:"computer",side:"black",timeFinished:(new Date).toLocaleString(),verify:verify};socket.emit("winner",t)}this.gameOver()}else this.scoreRight>=gameProperties.scoreToWin?(isHome?socket.emit("winner",{id:"black"===this.side?opponent||localStorage.getItem("opponentId"):userId,points:this.rightStrikeCount+3*this.scoreRight,pointsLoser:this.scoreLeft,loserId:"black"===this.side?userId:opponent||localStorage.getItem("opponentId"),side:"white",timeFinished:(new Date).toLocaleString(),verify:verify}):computer&&"white"===this.side&&socket.emit("winner",{id:userId,points:this.rightStrikeCount+3*this.scoreRight,pointsLoser:this.scoreLeft,loserId:"computer",side:"white",timeFinished:(new Date).toLocaleString(),verify:verify}),this.gameOver()):this.resetBall()},resetScores:function(){this.scoreLeft=0,this.scoreRight=0,this.updateScoreTextFields()},updateScoreTextFields:function(){jQuery("#left-score").html(this.scoreLeft);for(var e=3*this.scoreLeft+this.leftStrikeCount;e.toString().length<5;)e="0"+e;jQuery("#left-score-go").html(this.scoreLeft),$("#left-points").html(e),$("#left-points-go").html(e),jQuery("#right-score").html(this.scoreRight);for(var t=3*this.scoreRight+this.rightStrikeCount;t.toString().length<5;)t="0"+t;jQuery("#right-points").html(t),jQuery("#right-points-go").html(t),jQuery("#right-score-go").html(this.scoreRight)},hideTextFields:function(){this.instructions.visible=!1}},$("#munch-pong").length>0){var game=new Phaser.Game(gameProperties.screenWidth,gameProperties.screenHeight,Phaser.AUTO,"munch-pong",!1,!0);game.state.add("main",mainState),game.state.start("main")}