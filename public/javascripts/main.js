"use strict";function getRankIcon(e){var t;return e<=100&&(t="/assets/ranks/1.png"),e>=101&&e<=200&&(t="/assets/ranks/2.png"),e>=201&&e<=300&&(t="/assets/ranks/3.png"),e>=301&&e<=400&&(t="/assets/ranks/4.png"),e>=401&&e<=500&&(t="/assets/ranks/5.png"),e>=501&&e<=600&&(t="/assets/ranks/6.png"),e>600&&(t="/assets/ranks/7.png"),t}function setSelectedSide(e){"white"===e?($("#pickWhite .active").show(),$("#pickWhite .inactive").hide(),$("#pickBlack .inactive").show(),$("#pickBlack .active").hide()):"black"===e&&($("#pickWhite .active").hide(),$("#pickWhite .inactive").show(),$("#pickBlack .inactive").hide(),$("#pickBlack .active").show())}var socket;if(function(){localStorage.getItem("side")||localStorage.setItem("side","black"),localStorage.getItem("muted")||localStorage.setItem("muted","true");"true"===localStorage.getItem("muted")?($(".sound-off-wrapper").addClass("active"),$(".sound-on-wrapper").removeClass("active")):($(".sound-on-wrapper").addClass("active"),$(".sound-off-wrapper").removeClass("active")),document.getElementById("toggle-sound").addEventListener("click",function(e){try{toggleSound()}catch(e){console.debug(e)}})}(),(socket=io.connect()).on("connected",function(e){e.status&&(window.sync=e.sync,socket.emit("identify",{id:userId}))}),socket.on("syncSingle",function(e){window.sync=e.sync}),socket.on("respond_to_invite",function(e){if(0===$("#turn").length){if(console.log("accept invite",e),localStorage.setItem("opponentSide",e.guestSide),e.player1.profile.PlayerId!==userId){localStorage.setItem("opponentId",e.player1.profile.PlayerId),$("#accept_modal").modal(),$("#opponent-rank").html('<img src="'+getRankIcon(_.find(e.player1.stats.data.Statistics,{StatisticName:"Total Points"})?_.find(e.player1.stats.data.Statistics,{StatisticName:"Total Points"}).Value:0)+'"/>'),$("#opponent-name").html(e.profile.DisplayName);for(t=parseInt(e.ranks.daily.Position,10)+1;t.toString().length<5;)t="0"+t;for(i=parseInt(e.ranks.daily.Position,10)+1;i.toString().length<5;)i="0"+i;for(o=parseInt(e.ranks.daily.Position,10)+1;o.toString().length<5;)o="0"+o;$("#daily-rang").html(t),$("#weekly-rang").html(i),$("#total-rang").html(o),$("."+e.guestSide).show()}else{$("#invited_modal").modal(),$("#challenger-rank").html('<img src="'+getRankIcon(_.find(e.player2.stats.data.Statistics,{StatisticName:"Total Points"})?_.find(e.player2.stats.data.Statistics,{StatisticName:"Total Points"}).Value:0)+'"/>'),$("#challenger-name").html(e.player2.profile.DisplayName);for(var t=parseInt(e.ranks.daily.Position,10)+1;t.toString().length<5;)t="0"+t;for(var i=parseInt(e.ranks.daily.Position,10)+1;i.toString().length<5;)i="0"+i;for(var o=parseInt(e.ranks.daily.Position,10)+1;o.toString().length<5;)o="0"+o;$("#challenger-daily-rang").html(t),$("#challenger-weekly-rang").html(i),$("#challenger-total-rang").html(o),"white"===e.guestSide?$(".black").show():$(".white").show()}e.player2.profile.PlayerId!==userId&&localStorage.setItem("opponentId",e.player2.profile.PlayerId)}}),$("#accept_invite").click(function(){$("#accept_modal").modal("hide"),socket.emit("accept",{guest:localStorage.getItem("opponentId"),host:userId,guestSide:localStorage.getItem("opponentSide")}),-1===window.location.href.indexOf("play?")&&(window.location.href="/play?game="+userId+"&noevent=true")}),jQuery("#games").length>0&&!noevent&&(-1===window.location.href.indexOf("?game=")&&-1===window.location.href.indexOf("?computer")?window.location.href="/profile":window.location.href.indexOf("?game=")>-1&&socket.emit("invite",{host:opponent,guest:userId,guestProfile:profile,guestStats:stats,guestSide:localStorage.getItem("side")})),jQuery("#opponents").length>0&&$.get("/profile/actives",function(e){var t=0;for(var i in e)i!==userId&&(t++,$("#opponents").append('<div class="opponents-row opponents-head-row row"><a href="/play?game='+e[i].profile.PlayerId+'">    <div class="col-md-4 col-xs-8 text-left"><img src="'+getRankIcon(e[i].ranks.total.Position)+'"><span>'+e[i].profile.DisplayName+'</span></div>    <div class="col-md-8 col-xs-4">        <div class="row">            <div class="col-md-2 col-xs-12 borders">'+e[i].ranks.total.Position+'</div>            <div class="col-md-2 borders hide-on-mobile">'+e[i].ranks.weekly.Position+'</div>            <div class="col-md-2 borders hide-on-mobile">'+e[i].ranks.daily.Position+'</div>            <div class="col-md-2 borders hide-on-mobile">'+e[i].ranks.total.StatValue+'</div>            <div class="col-md-2 borders hide-on-mobile">'+e[i].ranks.weekly.StatValue+'</div>            <div class="col-md-2 borders hide-on-mobile">'+e[i].ranks.daily.StatValue+"</div>        </div>    </div></a></div>"));0===t&&($("#opponent-search-container").hide(),$("#no-opponents").show())}),jQuery(".search-users #name").length>0&&jQuery(".search-users #name").on("change paste keyup",function(){if($(this).val().length>2){e=0;$("#opponents").html('<div class="row opponents-row opponents-head-row">                       <div class="col-md-4 col-xs-8 text-left">nadimak</div>                       <div class="col-md-8 col-xs-4">                           <div class="row">                               <div class="col-md-2 col-xs-12 borders">ukupni<br/>rang</div>                               <div class="col-md-2 borders hide-on-mobile">nedeljni<br/>rang</div>                               <div class="col-md-2 borders hide-on-mobile">dnevni<br/>rang</div>                               <div class="col-md-2 borders hide-on-mobile">ukupno<br/>poena</div>                               <div class="col-md-2 borders hide-on-mobile">nedeljnih<br/>poena</div>                               <div class="col-md-2 borders hide-on-mobile">dnevnih<br/>poena</div>                           </div>                       </div>                   </div>'),$.get("/profile/actives?filter="+$(this).val(),function(t){for(var i in t)i!==userId&&(e++,$("#opponents").append('<div class="row opponents-row"><a href="/play?game='+t[i].profile.PlayerId+'">    <div class="col-md-4 col-xs-8 text-left"><img src="'+getRankIcon(t[i].ranks.total.Position)+'"><span>'+t[i].profile.DisplayName+'</span></div>    <div class="col-md-8 col-xs-4">        <div class="row">            <div class="col-md-2 col-xs-12 borders">'+t[i].ranks.total.Position+'</div>            <div class="col-md-2 borders hide-on-mobile">'+t[i].ranks.weekly.Position+'</div>            <div class="col-md-2 borders hide-on-mobile">'+t[i].ranks.daily.Position+'</div>            <div class="col-md-2 borders hide-on-mobile">'+t[i].ranks.total.StatValue+'</div>            <div class="col-md-2 borders hide-on-mobile">'+t[i].ranks.weekly.StatValue+'</div>            <div class="col-md-2 borders hide-on-mobile">'+t[i].ranks.daily.StatValue+"</div>        </div>    </div></a></div>"));0===e&&($("#opponent-search-container").hide(),$("#no-opponents").show())})}else if(0===$(this).val().length){var e=0;$("#opponents").html('<div class="row opponents-row opponents-head-row">                       <div class="col-md-4 col-xs-8 text-left">nadimak</div>                       <div class="col-md-8 col-xs-4">                           <div class="row">                               <div class="col-md-2 col-xs-12 borders">ukupni<br/>rang</div>                               <div class="col-md-2 borders hide-on-mobile">nedeljni<br/>rang</div>                               <div class="col-md-2 borders hide-on-mobile">dnevni<br/>rang</div>                               <div class="col-md-2 borders hide-on-mobile">ukupno<br/>poena</div>                               <div class="col-md-2 borders hide-on-mobile">nedeljnih<br/>poena</div>                               <div class="col-md-2 borders hide-on-mobile">dnevnih<br/>poena</div>                           </div>                       </div>                   </div>'),$.get("/profile/actives",function(t){for(var i in t)i!==userId&&(e++,$("#opponents").append('<div class="row opponents-row"><a href="/play?game='+t[i].profile.PlayerId+'">    <div class="col-md-4 col-xs-8 text-left"><img src="'+getRankIcon(t[i].ranks.total.Position)+'"><span>'+t[i].profile.DisplayName+'</span></div>    <div class="col-md-8 col-xs-4">        <div class="row">            <div class="col-md-2 col-xs-12 borders">'+t[i].ranks.total.Position+'</div>            <div class="col-md-2 borders hide-on-mobile">'+t[i].ranks.weekly.Position+'</div>            <div class="col-md-2 borders hide-on-mobile">'+t[i].ranks.daily.Position+'</div>            <div class="col-md-2 borders hide-on-mobile">'+t[i].ranks.total.StatValue+'</div>            <div class="col-md-2 borders hide-on-mobile">'+t[i].ranks.weekly.StatValue+'</div>            <div class="col-md-2 borders hide-on-mobile">'+t[i].ranks.daily.StatValue+"</div>        </div>    </div></a></div>"));0===e&&($("#opponent-search-container").hide(),$("#no-opponents").show())})}}),$("#pickWhite").length>0){var side=localStorage.getItem("side");setSelectedSide(side),$("#pickBlack").click(function(){localStorage.setItem("side","black"),setSelectedSide("black")}),$("#pickWhite").click(function(){localStorage.setItem("side","white"),setSelectedSide("white")})}"undefined"!=typeof computer&&computer&&$("#game-over").length>0&&("black"===localStorage.getItem("side")&&($("#left-name, #left-name-go").html(profile.DisplayName),$("#left-rank, #left-rank-go").html('<img src="'+getRankIcon(_.find(stats.data.Statistics,{StatisticName:"Total Points"})?_.find(stats.data.Statistics,{StatisticName:"Total Points"}).Value:0)+'"/>'),$("#right-name, #right-name-go").html("Computer"),$("#right-rank, #right-rank-go").html('<img src="/assets/ranks/8.png"/>')),"white"===localStorage.getItem("side")&&($("#left-name, #left-name-go").html("Computer"),$("#left-rank, #left-rank-go").html('<img src="/assets/ranks/8.png"/>'),$("#right-rank, #right-rank-go").html('<img src="'+getRankIcon(_.find(stats.data.Statistics,{StatisticName:"Total Points"})?_.find(stats.data.Statistics,{StatisticName:"Total Points"}).Value:0)+'"/>'),$("#right-name, #right-name-go").html(profile.DisplayName))),$(".fetch-rank-row").length>0&&$(".fetch-rank-row").each(function(e){var t=$(this).data("playerid"),i=this;$.get("/ranking/rankings?PlayFabId="+t,function(e){if(e.weekly){for(e.weekly.Position=parseInt(e.weekly.Position,10)+1;e.weekly.Position.toString().length<5;)e.weekly.Position="0"+e.weekly.Position;for($(i).children().find(".weekly-rank").html(e.weekly.Position);e.weekly.StatValue.toString().length<5;)e.weekly.StatValue="0"+e.weekly.StatValue;$(i).children().find(".weekly-points").html(e.weekly.StatValue)}else $(i).children().find(".weekly-rank").html("00000"),$(i).children().find(".weekly-points").html("00000");if(e.daily){for(e.daily.Position=parseInt(e.daily.Position,10)+1;e.daily.Position.toString().length<5;)e.daily.Position="0"+e.daily.Position;for($(i).children().find(".daily-rank").html(e.daily.Position);e.daily.StatValue.toString().length<5;)e.daily.StatValue="0"+e.daily.StatValue;$(i).children().find(".daily-points").html(e.daily.StatValue)}else $(i).children().find(".daily-rank").html("00000"),$(i).children().find(".daily-points").html("00000");if(e.total){for(e.total.Position=parseInt(e.total.Position,10)+1;e.total.Position.toString().length<5;)e.total.Position="0"+e.total.Position;for($(i).children().find(".total-rank").html(e.total.Position);e.total.StatValue.toString().length<5;)e.total.StatValue="0"+e.total.StatValue;$(i).children().find(".total-points").html(e.total.StatValue)}else $(i).children().find(".total-rank").html("00000"),$(i).children().find(".total-points").html("00000")})});